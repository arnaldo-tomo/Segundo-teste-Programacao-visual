@model dynamic
@{
    Layout = null;
}

@if (Session["email"] == null)
{
    <script> location.href='/'; </script>
}


<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Comprar Produtos</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="~/vendors/iconfonts/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="~/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="~/vendors/css/vendor.bundle.addons.css">
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <!-- endinject -->
    <!-- plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="~/css/styles.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="~/images/favicon.png" />
</head>
<body>

<style>

.table{
  border-collapse: collapse;
  margin: 25px 0;
  font-size: 15px;
  min-width: 100%;
  overflow: hidden;
  border-radius: 5px 5px 0 0;
}
table thead tr{
  color: #fff;
  background: #34AF6D;
  text-align: left;
  font-weight: bold;
}
.table th,
.table td{
  padding: 12px 15px;
}
.table tbody tr{
  border-bottom: 1px solid #ddd;
}
.table tbody tr:nth-of-type(odd){
  background: #f3f3f3;
}
.table tbody tr.active{
  font-weight: bold;
  color: #4AD489;
}
.table tbody tr:last-of-type{
  border-bottom: 2px solid #4AD489;
}
.table button{
  padding: 6px 20px;
  border-radius: 10px;
  cursor: pointer;
  background: transparent;
  border: 1px solid #4AD489;
}
.table button:hover{
  background: #4AD489;
  color: #fff;
  transition: 0.5rem;
}
</style>
    <div class="container-scroller">
        <!-- partial:partials/_navbar.html -->
        <nav class="navbar default-layout col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
            <div class="text-center navbar-brand-wrapper d-flex align-items-top justify-content-center">
              
                    <a class="navbar-brand brand-logo-mini" href="/Main/Index">
                    </a>
            </div>
            <div class="navbar-menu-wrapper d-flex align-items-center">
              
                <ul class="navbar-nav navbar-nav-right">
                
                    <li class="nav-item dropdown d-none d-xl-inline-block">
                        <a class="nav-link dropdown-toggle" id="UserDropdown" href="#" data-toggle="dropdown" aria-expanded="false">
                            <span class="profile-text">Arnaldo Tomo</span>
                            <img class="img-xs rounded-circle" src="~/images/faces/git.jpg" alt="Profile image">
                        </a>
                        <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="UserDropdown">
                            <a class="dropdown-item p-0">
                                <div class="d-flex border-bottom">
                                    <div class="py-3 px-4 d-flex align-items-center justify-content-center">
                                        <i class="mdi mdi-bookmark-plus-outline mr-0 text-gray"></i>
                                    </div>
                                    <div class="py-3 px-4 d-flex align-items-center justify-content-center border-left border-right">
                                        <i class="mdi mdi-account-outline mr-0 text-gray"></i>
                                    </div>
                                    <div class="py-3 px-4 d-flex align-items-center justify-content-center">
                                        <i class="mdi mdi-alarm-check mr-0 text-gray"></i>
                                    </div>
                                </div>
                            </a>
                            <a class="dropdown-item mt-2">
                               Gerenciar contas
                            </a>
                            <a class="dropdown-item">
                                Mudar Senha 
                            </a>
                          
                            <a class="dropdown-item" href="Logout" style="cursor:pointer">
                                Sign Out
                            </a>
                        </div>
                    </li>
                </ul>
                <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
                    <span class="icon-menu"></span>
                </button>
            </div>
        </nav>
        <!-- partial -->
        <div class="container-fluid page-body-wrapper">
            <!-- partial:partials/_sidebar.html -->
             <nav class="sidebar sidebar-offcanvas" id="sidebar">
                <ul class="nav">
                    <li class="nav-item nav-profile">
                        <div class="nav-link">
                            <div class="user-wrapper">
                                <div class="profile-image">
                                    <img src="~/images/faces/git.jpg" alt="profile image">
                                </div>
                                <div class="text-wrapper">
                                    <p class="profile-name">Arnaldo Tomo</p>
                                    <div>
                                        <small class="designation text-muted">Gerente</small>
                                        <span class="status-indicator online"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- <button class="btn btn-success btn-block">
                                New Project
                                <i class="mdi mdi-plus"></i>
                            </button> -->
                        </div>
                    </li>
                    <li class="nav-item" >
                        <a class="nav-link active" href="/Main/Index">
                            <i class="menu-icon mdi mdi-television"></i>
                            <span class="menu-title">Dashboard</span>
                        </a>
                    </li>
             
                    <li class="nav-item">
                        <a class="nav-link" href="/Main/PurchaseItems">
                            <i class="menu-icon mdi mdi-backup-restore"></i>
                            <span class="menu-title">Comprar Produtos</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/Main/AddItem">
                            <i class="menu-icon mdi mdi-chart-line"></i>
                            <span class="menu-title">Adicionar Produtos</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/main/Sells">
                            <i class="menu-icon mdi mdi-table"></i>
                            <span class="menu-title">Vender Produtos</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/main/AddSupplier">
                            <i class="menu-icon mdi mdi-sticker"></i>
                            <span class="menu-title">Adicionar fornecedores</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/main/mystock">
                            <i class="menu-icon mdi mdi-sticker"></i>
                            <span class="menu-title">Em Stocks</span>
                        </a>
                    </li>
                   
                </ul>
            </nav>
            <!-- partial -->
            <div class="main-panel">
                <div class="content-wrapper" style="background-color:#bbb9b9">
                    <script>
                        $(document).ready(function () {
                            var id = $("#invoice_no").val();
                            if (id == "")
                            {
                                document.getElementById("invoice_no").value = "201801";
                            }
                            else
                            {
                                var invo = parseInt(id) + 1;
                                var datat = "invo=" + invo;
                                // alert(invo);

                                document.getElementById("invoice_no").value = invo;
                            }
                            
                            //$.ajax({
                            //    type: "post",
                            //    url: "Item_Stock",
                            //    async:false,
                            //    data: datat,
                            //    success:function($dd)
                            //    {
                            //        ///$("#view_added_item").html($dd);
                            //    }

                            //});

                        });
                                        </script>
                                        <script>
                        $(document).ready(function () {

                                var id = $("#invoice_no").val();
                               // alert(id);
                                var alldata = "id=" + id;
                                //alert(alldata);
                                $.ajax({
                                    type: "POST",
                                    url: "Total_Order_Price",
                                    async: false,
                                    data: alldata,

                                    success: function ($dat) {
                                        //alert($data)
                                        //var pr = $data;
                                       // alert($dat)
                                       // document.getElementById("t").value = $dat;
                                       // document.getElementById("sum").value = $dat;

                                    }
                                });

                        });
                                        </script>
                                        <script>
                        $(document).ready(function () {
                            $("#itemname").change(function () {
                                var id = $("#itemname").val();
                                //alert(id);
                                var alldata = "id=" + id;
                                

                                $.ajax({
                                    type: "POST",
                                    url: "GetPrice",
                                    async: false,
                                    data: alldata,

                                    success: function($data)
                                    {
                                        //alert($data)
                                        //var pr = $data;
                                        //alert(pr)
                                        document.getElementById("p").value = $data;

                                    }
                                });
                            });
                        });
                                        </script>

                                        <script>
                        $(document).ready(function () {
                            $("#add_stock_item").click(function () {
                                var sum = null;

                                var id = "1";
                                var invoice_no = $("#invoice_no").val();
                                var bill_date = $("#bill_date").val();
                                var supplier_name = $("#supplier_name").val();
                                var receiving_date = $("#receiving_date").val();
                                var carrying_charge = $("#carrying_charge").val();
                                var itemname = $("#itemname").val();
                                var quantity = $("#quantity").val();
                                var p = $("#p").val();
                                var total_price_per_item = $("#total_price_per_item").val();
                                var total_amount = $("#item_idd").val();
                                var data = "id=" + invoice_no;


                               // alert(data);
                                var stock_item = "id="+id+"&invoice_no=" + invoice_no + "&bill_date=" + bill_date + "&supplier_name=" + supplier_name + "&receiveing_date="+ receiving_date + "&carrying_charge=" + carrying_charge + "&item_name=" + itemname + "&quantity=" + quantity + "&price=" + p + "&total_price_per_item=" + total_price_per_item + "&total_amount=" + total_amount;
                                //alert(stock_item);
                                $.ajax({
                                    type: "POST",
                                    url: "Save_New_Order",
                                    data: stock_item,
                                    async: false,
                                    success:function($show_datas)
                                    {
                                        //window.location.reload();
                                        //alert($show_datas)
                                        $("#view_added_item").html($show_datas);
                                       // document.getElementById("data_in_item").style.display = "none";

                                    }
                                });

                                $.ajax({
                                    type: "POST",
                                    url: "Total_Order_Price",
                                    data: data,
                                    async: false,
                                    success: function ($yo) {
                                       // window.location.reload();
                                        //alert($show_datas)
                                       // alert("sum is working");
                                        // $("#view_added_item").html($yo);

                                        var sum = document.getElementById("sum").value = $yo;


                                    }
                                });
                                $.ajax({
                                    type: "POST",
                                    url: "Carry_Charge",
                                    data: data,
                                    async: false,
                                    success: function ($yo) {
                                        // window.location.reload();
                                        //alert($show_datas)
                                        // alert("sum is working");
                                        // $("#view_added_item").html($yo);

                                        var ccc = document.getElementById("carry_charge").value = $yo;


                                    }
                                });

                                var sum_text = $("#sum").val();
                               // alert(sum_text);
                                var carry_ch = $("#carry_charge").val();
                               // alert(carry_ch);
                                var tota = parseInt(sum_text) + parseInt(carry_ch);
                               // alert(tota);
                                document.getElementById("dammy_sum").value = tota;

                            });
                        });

                                        </script>
                                        <script>
                        //$(document).ready(function () {
                        //    $("#Save_Stock").click(function () {
                        //        var inv = $("#invoice_no").val();
                        //        var inv_no = parseInt(inv) + 1;
                        //        alert(inv_no);
                        //        document.getElementById("invoice_no").value = inv_no;
                        //        alert("hide");
                        //    });
                        //});
                                        </script>
                    <script>
                        $(document).ready(function () {
                            var invoice_no = $("#invoice_no").val();

                            $.ajax({
                                type: "POST",
                                url: "Load_Previous_Ordered_Item",
                                data: { invoice_no: invoice_no },
                                success:function(data)
                                {
                                    
                                    $("#view_added_item").html(data);
                                }
                            });
                        });
                    </script>
                    
                                        <h2>Produtos em estouqe</h2>
                                        @*este formulário apenas envie a fatura no e valor total para o controlador para salvá-lo o resto é salvo através do ajax*@
                    <form method="post" action="Final_Submit_Order">
                        <div class="row">
                            @*<h3>detalhes do pedido</h3>*@
                            <div class="col-sm-3">
                                <p>Nº da fatura</p><input type="text" name="invoice_no" value="@foreach (var m in Model.invoice_4m_total) { @m.invoice_no_t}" id="invoice_no" class="form-control" />
                            </div>
                            <div class="col-sm-3">
                                <p>Data da conta</p><input type="date" name="billdate" id="bill_date" class="form-control" />
                                @*<input type="text" name="current_date" value="@DateTime.Now.ToString("dd/MM/yyyy")" />*@
                            </div>
                            <div class="col-sm-3">
                                <p>Total de Produtos em estouqe</p><input type="text"  name="total_stock" id="total_stock" class="form-control" />
                                @*<input type="text" name="current_date" value="@DateTime.Now.ToString("dd/MM/yyyy")" />*@
                            </div>


                        </div>
                        <div class="row" style="background-color:">
                            <div class="col-sm-3">
                                <p>Nome do Fornecedor</p>
                                <select class="form-control" autofocus name="supplier_name" id="supplier_name">
                                    @foreach (var sup in Model.supplier_data)
                                    {
                                        <option>@sup.sup_name</option>
                                    }
                                </select>
                            </div>

                            <div class="col-sm-3">
                                <p>Carga de Transporte</p><input type="text" name="carrying_charge" id="carrying_charge" class="form-control" />
                            </div>
                            <div class="col-sm-3">
                                <p>Data de Recebimento</p><input type="date" name="receiving_date" id="receiving_date" class="form-control" />
                            </div>

                        </div>
                        <script>
                    function find_Item_id()
                    {
                        var item_n = $("#itemname").val();
                       // alert(item_n);

                        $.ajax({
                            type:"post",
                            url:"Find_ID_Of_Item",
                            data:{item_n:item_n},
                            success:function($k)
                            {
                                //alert($k);
                                document.getElementById("item_idd").value = $k;
                            }
                        });
                         
                        $.ajax({
                            type: "post",
                            url: "Find_Stock_Of_Item",
                            data: { item_n: item_n },
                            success: function ($kk) {
                                //alert($k);
                                // alert("cool");
                                document.getElementById("total_stock").value = $kk;
                            }
                        });
                    }
                        </script>
                        <div class="row">
                            @*<h3>Produtos de ordem</h3>*@
                            <div class="col-sm-3">
                                <p>Nome do Produtos</p>
                                <select name="item" id="itemname" onchange="find_Item_id()" class="form-control">
                                    @foreach (var it in Model.item_data)
                                    {
                                        <option value="@it.item_name">@it.item_name</option>
                                    }
                                </select>
                                <input type="text" style="display:none" id="item_idd" value="" />
                            </div>
                            <script>
                                function calculate() {
                                    var q = $("#quantity").val();
                                    var p = $("#p").val();
                                    var pp = parseInt(p);
                                    var cc = $("#carrying_charge").val();
                                    //alert(q);
                                    //alert(pp);
                                    var total_q_p = parseInt(q) * pp;
                                    var total = total_q_p;
                                    document.getElementById("total_price_per_item").value = total;

                                }


                            </script>
                            <div class="col-sm-2">
                                <p>Quantidade</p><input type="text" onkeyup="calculate()" name="quantity" id="quantity" class="form-control" />
                            </div>
                            <div class="col-sm-2">
                                <p>Preço </p><input type="text" name="price" id="p" class="form-control" />

                            </div>
                            <div class="col-sm-2">
                                <p>Total</p><input type="text" class="form-control" id="total_price_per_item" name="total_price_per_item" />
                                <input type="text" class="form-control" style="display:none" id="total_amount" value="0" name="total_amount" />
                            </div>
                            <div class="col-sm-3">
                                <br /><br />
                                <button type="button" onclick="show_sum()" style="margin-top:-17px" name="add_stock_item" id="add_stock_item" class="btn btn-success">Addicionar Produtos</button>
                            </div>
                        </div>
                        <br />
                        <div class="row" id="view_added_item">
                        <!-- <div class="row" id="view_added_item"> -->
                            <table class="table">
                            <thead>
                                <tr>
                                    <th>ID#</th>
                                    <th>Nome do Produtos</th>
                                    <th>Quantidade</th>
                                    <th>Quantia</th>
                                    <th>Deletar</th>
                                </tr>
                               </thead>

                            </table>

                        </div>

                        <script>
                            function deleteda(id,invoice,quantity,item_id_in_sell,total_price_per_item)
                            {
                                //alert("yo");
                                //alert(id);
                                //alert(invoice);
                                //alert(quantity)
                                //alert(item_id_in_sell)
                                var total_price_per_item=total_price_per_item;
                                //alert(total_price_per_item);
                                var conf = confirm("VOCE TEM A CERTEZA?");
                                if(conf==true)
                                {
                                    $.ajax({
                                        url: "Delete_Item",
                                        type: 'POST',
                                        data: { id: id, invoice: invoice, quantity: quantity, item_id_in_sell: item_id_in_sell },

                                        success: function ($data) {
                                            $("#view_added_item").html($data);
                                            //window.location.href="PurchaseItems";
                                        }
                                    });

                                    var p_price=$("#dammy_sum").val();
                                    var new_price_after_deleting_item=parseInt(p_price)-parseInt(total_price_per_item);
                                    document.getElementById("dammy_sum").value = new_price_after_deleting_item;

                                }
                            }
                        </script>
                        <script>
                            function show_sum() {
                                //var aaaa = $("#sum").val();
                                //alert(aaaa)

                                //var sum_text = $("#sum").val();
                                //alert(sum_text);
                                //var carry_ch = $("#carry_charge").val();
                                //alert(carry_ch);
                                //var tota =parseInt( sum_text) + parseInt( carry_ch);
                                //alert(tota);
                                //document.getElementById("dammy_sum").value = tota;
                            }
                        </script>
                        <div class="row" id="">
                            <div class="col-sm-4"></div>
                            <div class="col-sm-4">
                                <h3>Valor total</h3><br /><input type="text" class="form-control" id="sum" style="display:none" name="total_amunt_t" />
                                <input type="text" class="form-control" id="carry_charge" style="display:none" name="carry_charge" />
                                <input type="text" class="form-control" id="dammy_sum" name="total_amount_t" />
                            </div>
                            <div class="col-sm-4"></div>
                        </div>
                        <div class="row">


                            <div class="col-sm-4"></div>
                            <div class="col-sm-4">
                                <br /><center><button type="submit" style="width:100%" onclik="save_stock()" class="btn btn-info" id="Save_Stock">Guardar em esqoue</button></center>
                            </div>
                            <div class="col-sm-4"></div>
                        </div>
                    </form>



                                        <script>
                        //$(document).ready(function () {
                        //    $("#Save_Stock").click(function () {
                        //       // alert("work");
                        //        var invoice = $("#invoice_no").val();
                        //        var total = $("#sum").val();
                        //        alert(invoice);
                        //        alert(total);
                        //        var data = "invoice_no=" + invoice+"&total_amount="+total;
                        //        alert(data);
                        //        $.ajax({
                        //            type: "post",
                        //            url: "Final_Submit_Order",
                        //            data: data,
                        //            success:function()
                        //            {
                        //                window.location.href = "Final_Submit_Order";
                        //            }
                        //        });

                        //    });
                        //});
                                        </script>

                </div>
                <!-- content-wrapper ends -->
                <!-- partial:partials/_footer.html -->
                <footer class="footer">
           
                </footer>
                <!-- partial -->
            </div>
            <!-- main-panel ends -->
        </div>
        <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="~/vendors/js/vendor.bundle.base.js"></script>
    <script src="~/vendors/js/vendor.bundle.addons.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page-->
    <!-- End plugin js for this page-->
    <!-- inject:js -->
    <script src="~/js/off-canvas.js"></script>
    <script src="~/js/misc.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script src="~/js/dashboard.js"></script>
    <!-- End custom js for this page-->
</body>
</html>